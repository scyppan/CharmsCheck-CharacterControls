<html lang="en">

<head>
    <meta charset="UTF-8">

    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>

    <script>
        (() => {
          const ttl    = 864e5;                     // 24 h
          const bucket = 'api-cache';
          const orig   = window.fetch.bind(window);
        
          // helper: returns cached Response if fresh, else null
          async function fromCache(cache, req) {
            const resp = await cache.match(req);
            if (!resp) return null;
            const ts = +resp.headers.get('x-cache-time') || 0;
            return (Date.now() - ts < ttl) ? resp.clone() : null;
          }
        
          window.fetch = async (url, opts={}) => {
            if (!url.includes('/wp-json/')) return orig(url, opts);
        
            const cache = await caches.open(bucket);
            const req   = new Request(url, opts);
        
            // 1. try cache
            const cached = await fromCache(cache, req);
            if (cached) return cached;
        
            // 2. network -> store clone
            const net = await orig(req);
            try {
              const clone = net.clone();
              const hdrs  = new Headers(clone.headers);
              hdrs.set('x-cache-time', Date.now());
              const cachedResp = new Response(await clone.blob(), { status: clone.status, statusText: clone.statusText, headers: hdrs });
              cache.put(req, cachedResp);
            } catch (e) { /* quota or opaque errors – ignore */ }
        
            return net;
          };
        })();
        </script>

    

    <link rel="stylesheet" href="css/page.css">
    <link rel="stylesheet" href="css/searchbox.css">
    <link rel="stylesheet" href="css/charsheetlayout.css">
    <link rel="stylesheet" href="css/overview.css">
    <link rel="stylesheet" href="css/skills.css">
    <link rel="stylesheet" href="css/spelldisplay.css">
    <link rel="stylesheet" href="css/proficiencydisplay.css">
    <link rel="stylesheet" href="css/potionsdisplay.css">
    <link rel="stylesheet" href="css/petsdisplay.css">
    <link rel="stylesheet" href="css/inventorydisplay.css">
    <link rel="stylesheet" href="css/relationshipdisplay.css">
    <link rel="stylesheet" href="css/settingdisplay.css">
    <link rel="stylesheet" href="css/rolldisplay.css">

    <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.js" defer></script>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Pangolin&display=swap">

    <script src="js/0globalvars/globalvars.js" defer></script>
    <script src="js/0api/cache.js" defer></script>
    <script src="js/0api/loadgiflogic.js" defer></script>
    <script src="js/0api/idleloader.js" defer></script>
    <script src="js/0api/apicall.js" defer></script>

    <script src="js/0tools/tools.js" defer></script>

    <script src="js/1htmlelements/searchbox.js" defer></script>
    <script src="js/1htmlelements/charsheetsetup.js" defer></script>

    <script src="js/2loadchar/loadchar.js" defer></script>

    <script src="js/3tabs/overviewtab.js" defer></script>
    <script src="js/3tabs/attributestab.js" defer></script>
    <script src="js/3tabs/spellstab.js" defer></script>
    <script src="js/3tabs/proficienciestab.js" defer></script>
    <script src="js/3tabs/potionstab.js" defer></script>
    <script src="js/3tabs/petstab.js" defer></script>
    <script src="js/3tabs/inventorytab.js" defer></script>
    <script src="js/3tabs/relationshipstab.js" defer></script>
    <script src="js/3tabs/settingstab.js" defer></script>

    <script src="js/tools/relationships.js" defer></script>
    <script src="js/tools/inventory.js" defer></script>
    <script src="js/tools/pets.js" defer></script>
    <script src="js/tools/potions.js" defer></script>
    <script src="js/tools/proficiencies.js" defer></script>
    <script src="js/tools/spells.js" defer></script>
    <script src="js/tools/books.js" defer></script>
    <script src="js/tools/courses.js" defer></script>
    <script src="js/tools/accessories.js" defer></script>
    <script src="js/tools/attributes.js" defer></script>
    <script src="js/tools/equipment.js" defer></script>
    <script src="js/tools/wands.js" defer></script>
    <script src="js/tools/traits.js" defer></script>
    <script src="js/tools/shortname.js" defer></script>
    <script src="js/tools/addvalstobtns.js" defer></script>

    <script src="js/4Functionality/roll.js" defer></script>
    <script src="js/4Functionality/rollclicks.js" defer></script>
    <script src="js/4Functionality/rolltools.js" defer></script>
    <script src="js/4Functionality/rolltext.js" defer></script>

    <script src="local.js" defer></script>

</head>

<body>

    <div id="loadinggif" class="hidden">
        loading character data, please wait...<br>
        <img src="https://charmscheck.com/wp-content/uploads/2023/10/Spinner-1.5s-311px.gif">
    </div>

    <div id="charsheetmain" class="hidden">

        <div class="searchbox-wrapper"></div>
        Character Search: <input id="searchbox" type="text"
            placeholder="Begin typing a character name to see available characters">
        <div id="suggestionscontainer"></div>

        <div id="chardisplay">
            <div id="leftheader">
                <img id="characterimg" />
                <div id="demographics">
                    <!-- e.g. character’s name, age, etc. -->
                </div>
            </div>
            <div id="rightheader">
                <!-- possibly other info/stats or a tagline -->
            </div>
        </div>
    </div>

</body>